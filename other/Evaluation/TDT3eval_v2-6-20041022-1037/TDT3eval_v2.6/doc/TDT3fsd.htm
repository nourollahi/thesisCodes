<!-- $Id: TDT3fsd.htm,v 1.3 2002/06/13 13:58:27 jon Exp $ -->
<HTML>
<HEAD>
<CENTER><TITLE>TDT3fsd.pl User Manual</TITLE></CENTER>
<A NAME="TDT3fsd.pl"> <B><BIG><CENTER>TDT3fsd.pl User Manual</CENTER></BIG></B></A>

<BR>
<CENTER> <H1> TDT3 First Story Detection Task Scoring </H1> </CENTER>

</HEAD>

<BODY><p><hr>


<H1>Usage:</H1>
<DIR>
	TDT3fsd.pl -R Rootdir -i 
	<A HREF="TDT3fsd.htm#FsdIndexFormat"> TDT3_fsd_index</A> &lt;Options&gt; 
	<A HREF="TDT3fsd.htm#DsdOutputFormat"> Fsd_system_output</A>
</DIR>

<P>The 'TDT3fsd.pl' program will score the output generated by a TDT3
First Story Detection (FSD) system.  The program requires the directory path,
'Rootdir', to the LDC's TDT3 Test corpus.  The corpus must be in the
same structure as released by the LDC, with all file formats identical
to their original form.  The program uses the index file <A HREF="TDT3fsd.htm#FsdIndexFormat"> TDT3_fsd_index</A>,
provided with the test corpus and described below, to load the
appropriate data from the corpus and to verify the completeness of the
<A HREF="TDT3fsd.htm#FsdOutputFormat"> Fsd_system_output</A> file.

<P> Upon completion of the load, the first story detection decisions are scored,
and a report is generated.  The scoring of an Automatic First Story Detection 
System (AFSDS) consists of two phases, first, the decisions
output by the AFSDS must be mapped onto the story boundaries annotated
in the reference corpus.  Then a topic set is built for each annotated topic.
The first on-topic story for each topic is considered the first story for that topic, and the
remaining on-topic stories are considered possible false alarms.
The program computes performance metrics constrained to only the annotated topics.


<P> The TDT3fsd.pl program can use two methods of mapping topic
decisions to reference stories, <i>majority vote</i> or <i>impulse
vote</i>.  The two methods differ in the meaning implied by decision
marker output by the AFSDS.

<DIR>
<bold> Majority Vote</bold>
<dir>
Each story decision is computed as the majority of decisions over all words (or time)
in that story, and each story score is computed as the average score over all words (time) 
in that story.  Ties in computing the decisions are broken by choosing the decision with
the maximum score.
</dir>
<bold> Impulse Vote</bold>
<dir>
Each story decision is made by selection the decision with the maximum score within
the boundaries of the story.  In the event no decisions were made for the story, the
decision is 'NO' with a score of -infinity.
</dir>
</DIR>


<P> The program concludes it processing by first generating a <A
HREF="#report">first story detection performance report</a> and then optionally a 
Decision Error Tradeoff (DET) graph.  

<P> The following &lt;Options&gt; are recognized by the program:

<DIR>
<TABLE BORDER=2> 
<TR> <TD> -C Cmiss:Cfa <TD> -> <TD> Set the cost of a missed detection and the cost of a
	false alarm to 'Cmiss' and 'Cfa' respectively.  These numbers are used in the 
	detection cost function.  Default values are Cmiss=1.0 and Cfa=0.1 ;
<TR> <TD> -D Detail <TD> -> <TD> Write internally organize evaluation corpus and pertinent 
			statistics for debugging purposes.  This report, though voluminous, is
			intended to help researchers debug their internal versions of
			evaluation code.
<TR> <TD> -E <A HREF="ssd.htm">SubsetFile</A> <TD> -> <TD> Compute performance excluding source files in the subset definition file.  NOTE: Only the first set defined in the subset definition file is used for the filter.  All others are ignored. 
<TR> <TD> -j topicrel[:topicrel]* <TD> -> <TD> Specify alternative topic relevance files via the command line.  More than one can be specified by concatenating the file names using a colon ':' separator.
<TR> <TD> <A NAME="opt_k">-k FSD_key</a> <TD> -> <TD> Write the loaded FSD answer key into 'FSD_key'.  See the <a href="TDT3fsd.htm#key_format">key format</a> below.
<TR> <TD> <A NAME="opt_K">-K FSD_key</a> <TD> -> <TD> Rather than generate the FSD answer key from the TDT corpus,  Read the 'FSD_key' file, and use it.  See the <a href="TDT3fsd.htm#key_format">key format</a> below.
<TR> <TD> -m func <TD> -> <TD> Set the system output to story mapping function to 
	either 'majority' or 'impulse'.  Default is 'majority'.
<TR> <TD> -P P(topic) <TD> -> <TD> Use P(topic) for the detection cost function.  Default is 0.02.
<TR> <TD> -r Report <TD> -> <TD> Write the summary report to 'Report' rather than STDOUT, the default.
<TR> <TD> -s <TD> -> <TD> Use all available speedups.  Currently, the only speedups involve 
			  NOT using 'nsmgls' and 'SGMLS.pm' parser and PERL libraries to read 
			  the TDT3 Corpus files. 
<TR> <TD> -v num <TD> -> <TD> Set the verbose level to 'num'. Default 1.<BR>
	                   ==0 None, ==1 Normal, >5 Slight, >10 way too much, >15 not even funny
<TR> <TD> -o LBL <TD> -> <TD> Treat the stories annotated as level 'LBL' as on topic.  The default
value is 'YES', but the value can also be 'YES+BRIEF', or 'BRIEF'.

<TR> <TD COLSPAN=3> <b><center>Options that apply to the DET plots:</center></b>
<TR> <TD> -d DETfile <TD> -> <TD> Create a DET plot in GNUplot format with the file
	root 'DETfile'.  The program makes several files each with additional extensions.
	The file 'DETfile'.plt is a command file for GNUplot and can be printed using the
	command "gnuplot 'DETfile'.plt | lpr". 
<TR> <TD> -t title <TD> -> <TD> Set the title line for the plot to 'title'.
<TR> <TD> -p       <TD> -> <TD> Produce a single story-weighted DET line trace.
<TR> <TD> -w       <TD> -> <TD> Produce a single topic-weighted DET line trace.  This is the default option.
<TR> <TD> -n       <TD> -> <TD> Add 90% confidence intervals to the topic-weighted DET graph.
<TR> <TD> -T Topic_regexp <TD> ->  <TD> Restrict the topics for which the  index files
			are created using the PERL regular expression 'Topic_regexp'.  The default
			is to use all occurring annotated topics.  There are a number of macro names
			for defined topic sets that may be used in place of regular expressions, 
			they are:
			<DIR>
			<table border=2> 
			<tr> <TH> Macro name </TH> <TH> Equivalent Expression </TH> </TR>
			<tr> <TD> TDT98_Train     </TD> <TD> 20+([1-9]|[12][0-9]|3[0-7])</TD></TR>
			<tr> <TD> TDT98_DevTest   </TD> <TD> 20+(3[89]|[45][0-9]|6[0-6])</TD></TR>
			<tr> <TD> TDT98_EvalTest  </TD> <TD> 20+(6[7-9]|[89][0-9]|100)</TD></TR>
			<tr> <TD> TDT99_mul       </TD> <TD> 20+(1|2|5|7|13|15|20|23|39|44|48|57|70|71|76|85|88|89|91|96)</TD></TR>
			</table>
			</DIR>
</TABLE>
</DIR>

<A NAME="FsdIndexFormat"> <H2> First Story Detection Task Index File Format </H2> </A>

The index file for the first story detection file is as follows.  The first
line in the index file is a header line.  The line indicates the TDT3
task, 'FIRST_STORY' in this case, and the type of pointer used to
mark segment changes.  Each subsequent data record in the file will
identify a source file to process. These records will have one field
and be separated with a newline.

<P> The BNF structure of the first story detection index file is:
	
<DIR>
	&lt;HEADER_LINE&gt; <BR>
	&lt;SOURCE&gt;	<BR>
	&lt;SOURCE&gt;	<BR>
	...
	<P>	

Where:
	<DIR>
	<TABLE BORDER=2>
	<TR> <TD> &lt;HEADER_LINE&gt;   <TD> :== <TD> <B>  # FIRST_STORY &lt;POINTER_TYPE&gt; </B>
	<TR> <TD> <DIR>  &lt;POINTER_TYPE&gt; </DIR>  <TD> :== <TD> <B>  RECID | TIME </B> <BR>
		A POINTER_TYPE is the type of boundaries to be output by the
		system. The possible values are RECID for text stream
		first story detection or TIME for audio first story detection.
	<TR> <TD> &lt;SOURCE&gt; <TD> :== <TD> TDT3 corpus filename with
			directory and extension names relative to the TDT3
			root directory specified on the command line.
	</TABLE>
	</DIR>

</DIR>

The following is an excerpt from a first story detection task index file.

<DIR>
<pre>
# FIRST_STORY RECID
tkntext/19980301_0553_0719_APW_ENG.tkn
tkntext/19980301_1014_1116_APW_ENG.tkn
tkntext/19980301_1403_1529_APW_ENG.tkn
tkntext/19980301_2139_2341_APW_ENG.tkn
tkntext/19980302_0630_0651_APW_ENG.tkn
</PRE>
</DIR>

<A NAME="FsdOutputFormat"><H2> First Story Detection Task System Output Format </H2></A>


The task of First Story Detection task is to detect in a chronologically
order stream of stories the first story that discusses an event. 
FSD systems will perform this task by
recording information about these hypothesized points in a file, one
record for each putative discussion of a new event, written in ASCII
format. The first record in this file will contain four fields which
specify information that applies globally to the whole file. 

Comment lines begin with the '#' character, and any text following a
'#' is ignored.  The exception to this rule is the first comment line
can optionally contain a long description of the system under test.  This
description will be included in the scoring report along side the
&lt;SYSTEM&gt; value described below.  After the initial comment line,
blank lines are treated as comments.

<P> The BNF structure of the first story detection system output file is:
	
<DIR>
	&lt;SYSTEM&gt; &lt;BOUNDARIES&gt; &lt;DEF_PERIOD&gt; &lt;POINTER_TYPE&gt; <BR>
	&lt;DECISION_LINE&gt; <BR>
	&lt;DECISION_LINE&gt; <BR>
	...
	<P>	

Where:
	<DIR>
	<TABLE BORDER=2>
	<TR> <TD> &lt;SYSTEM&gt; <TD> :== <TD> System is an alphanumeric
			character string that uniquely identifies the
			system being tested. (E.g., CDM_P05-8.v37)
	<TR> <TD> &lt;BOUNDARIES&gt; <TD> :== <TD> Boundaries is either
			YES or NO, where YES indicates that story
			boundaries are supplied to the system being
                        tested and NO indicates that they are not.

	<TR> <TD> &lt;DEF_PERIOD&gt;   <TD> :== <TD> The deferral period before
						before decisions are made.
						Permissible values defined by
						the TDT3 test specification.
	<TR> <TD> &lt;POINTER_TYPE&gt; <TD> :== <TD> <B>  RECID | TIME </B> <BR>
		POINTER_TYPE is the type of boundaries to be output by
		the system. The possible values are RECID for text
		stream first story detection or TIME for audio first story detection.

	<TR>

	<TR> <TD> &lt;DECISION_LINE&gt; <TD> :== <TD>
		&lt;SOURCE&gt; &lt;POINTER&gt; &lt;DECISION&gt;	&lt;SCORE&gt;
	<TR> <TD> <DIR> &lt;SOURCE&gt; </DIR> <TD> :== <TD> TDT3 corpus filename with
			directory and extension names relative to the TDT3
			root directory specified on the command line.
	<TR> <TD> <DIR> &lt;POINTER&gt; </DIR> <TD> :== <TD> POINTER is a
		hypothesized decision point. For text files, Pointer is the
		index number of the first word in the hypothesized
		segment, in the range {1, 2, . . .}. For audio files,
		Boundary is the time of the beginning of the segment
		{0.0, . . .}. (It isn't necessary to output the
		beginning of the first segment.) The hypothesized
		Boundary points must occur in chronological order.

	<TR> <TD> <DIR> &lt;DECISION&gt; </DIR> <TD> :== <TD>
                        Decision is either YES or NO, where YES
			indicates that the system believes that the
			story being processed
                        discusses the target topic, and NO indicates not.
	<TR> <TD> <DIR> &lt;SCORE&gt; </DIR> <TD> :== <TD> 
                       Score is a real number which indicates how
			confident the system is that the story being
			processed discusses the associated topic. More
			positive values indicate greater confidence.


	</TABLE>
	</DIR>


</DIR>
	
The following is an excerpt from a first story detection system output file.

<DIR>
<PRE>
# Degenerate first story detection results, Errors, RECID
Errors NO 10 RECID
asrtext/19980307_1130_1200_CNN_HDL.asr 1 NO 0.209696400470383
asrtext/19980307_1130_1200_CNN_HDL.asr 66 NO 0.0652269882628861
asrtext/19980307_1130_1200_CNN_HDL.asr 254 NO 0.00793375334496783
asrtext/19980307_1130_1200_CNN_HDL.asr 318 NO 0.000951696625507463
asrtext/19980307_1130_1200_CNN_HDL.asr 675 NO 2.05484371633647e-10
asrtext/19980307_1130_1200_CNN_HDL.asr 762 YES 0.999999999524702
</PRE>
</DIR>

<A NAME="key_format"><h2>FSD Key File Format</h2></a>

The key file is an alternative technique for specifying the stories to
be evaluation over during the scoring process.  The file is a simple,
sgml-style file that specifies the topics, for which topic weighted
performance is computed, and the stories for each topic that are
considered to be targets or nontargets, the first story for the topic or
subsequent on-topic stories respectively.  

<P> The file begins with a the tag &lt;FSD_KEY&gt; and ends with it's closing tag, &lt;/FSD_KEY&gt;.
Within the &lt;FSD_KEY&gt; tag, the following hierarchy exists:
<dir>
<table border=2>
<tr> <td> &lt;FSD_KEY&gt; <td> Contains <td> &lt;TOPIC&gt +;
<tr> <td> &lt;TOPIC&gt; <td> Contains <td>  ( &lt;TARG_STORY&gt; | &lt;NONTARG_STORY&gt; ) +
</table>
</dir>

The attributes for each tag type are:

<dir>
<table border=2>
<tr> <td> &lt;FSD_KEY&gt; <td colspan=3> None 
<tr> <td> &lt;TOPIC&gt; <td> id  <tD> -> <TD> The topic identifier string, e.g. 1,33,45
<tr> <td> &lt;TARG_STORY&gt; <td> docno <td> -> <td> The TDT Document number
<tr> <td> &lt;NONTARG_STORY&gt; <td>  docno <td> -> <td> The TDT Document number
</table>
</dir>


The following is an example FSD key file:
<dir>
<pre>
&lt;FSD_KEY&gt;
&lt;TOPIC id=1&gt;
&lt;TARG_STORY docno=APW19980194.0286&gt;
&lt;NONTARG_STORY docno=NYT19980104.0111&gt;
&lt;NONTARG_STORY docno=NYT19980104.0206&gt;
&lt;/TOPIC&gt;
&lt;TOPIC id=15&gt;
&lt;NONTARG_STORY docno=NYT19980108.0793&gt;
&lt;/TOPIC&gt;
&lt;/FSD_KEY&gt;
</pre>
</dir>

<A name="report"><H2> Example Output Report </H2></A>

<DIR>
<PRE>
-------------------------------------------------------------------------------
-------------  TDT First Story Detection Task Performance Report  ------------

Command line:   ../../TDT3eval_v1.1/TDT3fsd.pl -R fsd_root -i ....
Execution Date: Fri May 28 08:05:20 EDT 1999

Story Weighted First Story Detection: P(Miss)       = 0.3333
                                      P(Fa)         = 0.2222
                                      Cfsd          = 0.2244

Topic Weighted First Story Detection: P(Miss)       = 0.3333
                                      P(Fa)         = 0.2500
                                      Cfsd     *    = 0.3020

  *   Primary Evaluation Metric


First Story Detection Performance Calculations:

    Ref.                               | # Corr  # Miss   # Corr   # Fa     ||                        
    Topic           # First  # !First  | First   First    ! First  ! First  || P(Miss)  P(Fa)   Cfsd  
    -----           -------  --------  | ------  -------  ------   -------  || -------  -----   ------
    71                 1        2      |    1       0        2        0     || 0.0000   0.0000  0.0000
    74                 1        2      |    1       0        1        1     || 0.0000   0.5000  0.4900
    76                 1        2      |    0       1        2        0     || 1.0000   0.0000  0.0200
    77                 1        1      |    0       1        1        0     || 1.0000   0.0000  0.0200
    78                 1        1      |    1       0        0        1     || 0.0000   1.0000  0.9800
    79                 0        1      |   --      --        1        0     ||   --     0.0000    --  
    80                 1        0      |    1       0       --       --     || 0.0000     --      --  
    -----           -------  --------  | ------  -------  ------   -------  || -------  -----   ------
    Sums               6        9      |    4       2        7        2     ||                        
    Story Weighted                     |                                    || 0.3333   0.2222  0.2244
    Topic Weighted                     |    0.7     0.3      1.2      0.3   || 0.3333   0.2500  0.3020


LDC TDT Corpus Root Dir: fsd_root
Index File:              sys5.ndx
System Output File:      sys5.fsd
Pointer Type:            RECID
Cost Function Parameters:
              P(topic) = 0.02
              Cmiss    = 1
              Cfa      = 1

Detection Performance Calculations:
    System Identifier:   det_boundary_DEF=10
    Deferral Period:     10

System Output to Story Mapping Function:  'majority'

----------------  End of TDT Detection Task Performance Report  ---------------
-------------------------------------------------------------------------------
</PRE>
</DIR>

</BODY>
</HTML>
